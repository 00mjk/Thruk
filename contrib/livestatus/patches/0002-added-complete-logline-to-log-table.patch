From 42fb2fa42bc8f6eaf44a6cf75daa29643ef0e04d Mon Sep 17 00:00:00 2001
From: Sven Nierlein <sven@nierlein.de>
Date: Tue, 29 Dec 2009 19:36:59 +0100
Subject: [PATCH] added complete logline to log table


Signed-off-by: Sven Nierlein <sven@nierlein.de>
---
 livestatus/src/LogEntry.cc |    3 +++
 livestatus/src/LogEntry.h  |    1 +
 livestatus/src/TableLog.cc |    2 ++
 3 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/livestatus/src/LogEntry.cc b/livestatus/src/LogEntry.cc
index ba6c77c..0f9ffb6 100644
--- a/livestatus/src/LogEntry.cc
+++ b/livestatus/src/LogEntry.cc
@@ -23,6 +23,9 @@ LogEntry::LogEntry(char *line)
     _time = atoi(_msg+1);
     _text = _msg + 13; // also skip space after timestamp
 
+    // keep complete log line
+    _line = strdup(_text);
+
     // now classify the log message. Some messages
     // refer to other table, some do not.
     if (handleStatusEntry() ||
diff --git a/livestatus/src/LogEntry.h b/livestatus/src/LogEntry.h
index 7d829cb..db5367d 100644
--- a/livestatus/src/LogEntry.h
+++ b/livestatus/src/LogEntry.h
@@ -16,6 +16,7 @@ struct LogEntry
 {
     time_t     _time;
     unsigned   _logclass;
+    char      *_line;      // complete line without timestamp
     char      *_msg;       // split up with binary zeroes
     unsigned   _msglen;    // size of _msg
     char      *_text;      // points into msg
diff --git a/livestatus/src/TableLog.cc b/livestatus/src/TableLog.cc
index b19455e..491efdc 100644
--- a/livestatus/src/TableLog.cc
+++ b/livestatus/src/TableLog.cc
@@ -69,6 +69,8 @@ TableLog::TableLog()
 
     addColumn(new OffsetStringColumn("message", 
 		"The message (test)", (char *)&(ref->_text) - (char *)ref, -1));
+    addColumn(new OffsetStringColumn("line", 
+		"The logline without timestamp", (char *)&(ref->_line) - (char *)ref, -1));
     addColumn(new OffsetStringColumn("comment", 
 		"A comment field used in various message types", (char *)&(ref->_comment) - (char *)ref, -1));
     addColumn(new OffsetStringColumn("plugin_output", 
-- 
1.6.0.4

