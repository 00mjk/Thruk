INSTALLATION
============

the clean and proper way to install Thruk is to create a new local
user and install the missing perl modules with local::lib.

create new user
---------------
refer to your systems manual on howto add new user.
this guide uses the following:
user:  thruk
group: thruk

Install local::lib
------------------

IMPORTANT: all following steps should be done by the thruk user.

Follow the steps on http://search.cpan.org/perldoc?local::lib#The_bootstrapping_technique

quick guide:

    %> su - thruk
    %> wget http://search.cpan.org/CPAN/authors/id/A/AP/APEIRON/local-lib-1.004009.tar.gz
    %> tar zxf local-lib-1.004009.tar.gz
    %> cd local-lib-1.004009
    %> perl Makefile.PL --bootstrap && make install


Install Thruk Monitoring Webinterface
-------------------------------------

    git clone git@github.com:sni/Thruk.git
    cd Thruk
    perl Makefile.PL
    make

run perl Makefile.PL again to see if all dependecies are now installed properly.

    perl Makefile.PL


Configuration
=============
open "thruk.conf" and adjust the livestatus settings to your needs.



Test
====

verify installation with the packaged perl test

    make test



Start Server
============
After running these steps successfully, you should be able to test your installation:

    ./script/thruk_server.pl

Open your browser and open http://<your_host>:3000 


FastCGI Server
==============

you will need three additional perl modules:
FCGI, FCGI::ProcManager and Catalyst::Engine::FastCGI

start your fcgi server:

    %>./script/thuk_fastcgi.pl -n 5 \
                -l /tmp/thruk.socket \
                -p /tmp/thruk.pid


Apache Configuration
--------------------

use this apache example configuration:

 - replace /home/thruk/Thruk with your installation path
 - replace your-web-host.local with your hostname
 - create a /home/thruk/Thruk/htpasswd.users with htpasswd2
 - make sure the /home/thruk/Thruk/logs/ directory exists

--------------------------------
<VirtualHost *:80>
    ServerName   your-host.local

    DocumentRoot /home/thruk/Thruk/root/
    CustomLog    /home/thruk/Thruk/logs/access.log combined
    ErrorLog     /home/thruk/Thruk/logs/error.log

    # authorization
    <Location "/">
        AuthName "Monitoring Access"
        AuthType Basic
        AuthUserFile /home/thruk/Thruk/htpasswd.users
        Order Allow,Deny
        Allow from all
        require valid-user
    </Location>

    # Load fastcgi module unless already loaded
    LoadModule fastcgi_module /usr/lib/apache2/modules/mod_fastcgi.so

    # fastcgi configuration
    FastCGIExternalServer /tmp/thruk.fcgi -socket /tmp/thruk.socket

    # Load rewrite module unless already loaded
    LoadModule rewrite_module /usr/lib/apache2/modules/mod_rewrite.so

    # rewrite configuration
    RewriteEngine On
    RewriteCond %{HTTP:Authorization} ^(.+)
    RewriteRule ^(.*)$ $1 [E=HTTP_AUTHORIZATION:%1]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^/(.*)$ /tmp/thruk.fcgi/$1 [QSA,L]
</VirtualHost>
--------------------------------
